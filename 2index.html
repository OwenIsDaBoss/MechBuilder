<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Custom Mech Designer</title>
  <style>
    body {
      background-color: #1c1c1c;
      color: #d4af37; /* Gold color */
      font-family: Arial, sans-serif;
    }

    h1 {
      text-align: center;
      font-size: 36px;
      color: #d4af37;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
    }

    .section {
      background-color: #333;
      margin: 10px;
      padding: 15px;
      border-radius: 10px;
      width: 45%;
    }

    select, input[type="text"], button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 2px solid #d4af37;
      background-color: #222;
      color: #d4af37;
      border-radius: 5px;
    }

    button {
      cursor: pointer;
      font-weight: bold;
    }

    button:hover {
      background-color: #d4af37;
      color: #222;
    }

    .stats {
      margin-top: 20px;
      padding: 10px;
      background-color: #444;
      border-radius: 8px;
    }

    .stats h3 {
      font-size: 24px;
      color: #d4af37;
    }

    .stats p {
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h1>Custom Mech Designer</h1>
  
  <div class="container">
    <!-- Mech Designer Part -->
    <div class="section">
      <h2>Mech Designer</h2>
      <label for="mech-head">Head:</label>
      <select id="mech-head"></select>

      <label for="mech-torso">Torso:</label>
      <select id="mech-torso"></select>

      <label for="mech-arms">Arms:</label>
      <select id="mech-arms"></select>

      <label for="mech-legs">Legs:</label>
      <select id="mech-legs"></select>
    </div>

    <!-- Mech Statistics -->
    <div class="section">
      <h2>Mech Statistics</h2>
      <div class="stats" id="mech-stats">
        <h3>Stats</h3>
        <p>Armor: 100</p>
        <p>Speed: 50</p>
        <p>Firepower: 70</p>
        <p>Heat: 0</p>
        <p>Max Heat: 100</p>
      </div>
      <button onclick="saveMech()">Save Mech</button>
      <button onclick="loadMech()">Load Mech</button>
      <input type="file" id="fileInput" style="margin-top: 10px;" onchange="handleFileSelect(event)" />
      <button onclick="exportToJSON()">Export to JSON</button>
      <button onclick="exportToTXT()">Export to TXT</button>
    </div>
  </div>

  <!-- Weather Effects -->
  <div class="section">
    <h2>Weather Effects</h2>
    <label for="weather">Choose weather:</label>
    <select id="weather" onchange="applyWeather()">
      <option value="Clear">Clear</option>
      <option value="Rain">Rain</option>
      <option value="Snow">Snow</option>
      <option value="Thunderstorm">Thunderstorm</option>
      <option value="Sunny">Sunny</option>
    </select>
  </div>

  <!-- Faction Buffs and Debuffs -->
  <div class="section">
    <h2>Faction Buffs and Debuffs</h2>
    <label for="faction">Choose faction:</label>
    <select id="faction" onchange="applyFaction()">
      <option value="None">None</option>
      <option value="Armor Boost">Armor Boost</option>
      <option value="Speed Boost">Speed Boost</option>
      <option value="Heat Reduction">Heat Reduction</option>
    </select>
  </div>

  <script>
    const originalStats = {
      armor: 100,
      speed: 50,
      firepower: 70,
      heat: 0,
      maxHeat: 100,
    };

    let currentStats = { ...originalStats };

    // Variables to store weather and faction choices
    let currentWeather = "Clear";
    let currentFaction = "None";

    // Update the Mech Stats Display
    function updateStatsDisplay() {
      document.getElementById("mech-stats").innerHTML =
        `<h3>Stats</h3>
        <p>Armor: ${currentStats.armor}</p>
        <p>Speed: ${currentStats.speed}</p>
        <p>Firepower: ${currentStats.firepower}</p>
        <p>Heat: ${currentStats.heat}</p>
        <p>Max Heat: ${currentStats.maxHeat}</p>`;
    }

    // Fetch Mech Parts from Google Sheets
    async function fetchMechPartsFromSheet() {
      const sheetURL = "YOUR_GOOGLE_APPS_SCRIPT_URL_HERE";  // Replace with your actual URL
      try {
        const response = await fetch(sheetURL);
        const data = await response.json();
        populatePartSelects(data);
      } catch (error) {
        console.error("Error fetching mech parts:", error);
      }
    }

    // Populate dropdowns with parts data from Google Sheets
    function populatePartSelects(data) {
      const headSelect = document.getElementById("mech-head");
      const torsoSelect = document.getElementById("mech-torso");
      const armsSelect = document.getElementById("mech-arms");
      const legsSelect = document.getElementById("mech-legs");

      data.forEach(part => {
        const option = document.createElement("option");
        option.value = part['Part Name'];
        option.textContent = part['Part Name'];

        if (part['Part Type'] === 'Head') headSelect.appendChild(option);
        else if (part['Part Type'] === 'Torso') torsoSelect.appendChild(option);
        else if (part['Part Type'] === 'Arms') armsSelect.appendChild(option);
        else if (part['Part Type'] === 'Legs') legsSelect.appendChild(option);
      });
    }

    // Call fetch function on page load
    window.onload = fetchMechPartsFromSheet;

    // Save Mech to Local Storage
    function saveMech() {
      const mechData = {
        stats: currentStats,
        weather: currentWeather,
        faction: currentFaction,
      };
      localStorage.setItem("savedMech", JSON.stringify(mechData));
      alert("Mech saved locally!");
    }

    // Load Mech from Local Storage
    function loadMech() {
      const data = localStorage.getItem("savedMech");
      if (data) {
        const loadedMech = JSON.parse(data);
        currentStats = loadedMech.stats;
        currentWeather = loadedMech.weather;
        currentFaction = loadedMech.faction;

        document.getElementById("weather").value = currentWeather;
        document.getElementById("faction").value = currentFaction;

        applyWeather();
        applyFaction();
        updateStatsDisplay();
        alert("Mech loaded!");
      } else {
        alert("No saved mech found.");
      }
    }

    // Handle File Input and Load Mech from File
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file && file.name.endsWith(".json")) {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const mechData = JSON.parse(e.target.result);
            currentStats = mechData.stats;
            currentWeather = mechData.weather;
            currentFaction = mechData.faction;

            document.getElementById("weather").value = currentWeather;
            document.getElementById("faction").value = currentFaction;

            applyWeather();
            applyFaction();
            updateStatsDisplay();
            alert("Mech loaded from file!");
          } catch (error) {
            alert("Failed to load mech data. Invalid file format.");
            console.error(error);
          }
        };
        reader.readAsText(file);
      } else {
        alert("Please select a valid JSON file.");
      }
    }

    // Export Mech to JSON
    function exportToJSON() {
      const mechData = {
        stats: currentStats,
        weather: currentWeather,
        faction: currentFaction,
      };
      const json = JSON.stringify(mechData, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'mech.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Export Mech to TXT
    function exportToTXT() {
      const txt = `Mech Design:\n\nPart: ${currentStats.head}\nArmor: ${currentStats.armor}\nSpeed: ${currentStats.speed}\nFirepower: ${currentStats.firepower}\nHeat: ${currentStats.heat}\nMax Heat: ${currentStats.maxHeat}`;
      const blob = new Blob([txt], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'mech.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Apply Weather Effects
    function applyWeather() {
      const weather = document.getElementById("weather").value;
      resetStats();  // Reset stats before applying new effect

      currentWeather = weather;

      switch (weather) {
        case "Rain":
          currentStats.speed -= 5;
          break;
        case "Snow":
          currentStats.speed -= 10;
          break;
        case "Thunderstorm":
          currentStats.armor -= 10;
          break;
        case "Sunny":
          currentStats.speed += 5;
          break;
        default:
          break;
      }
      updateStatsDisplay();
    }

    // Apply Faction Buffs and Debuffs
    function applyFaction() {
      const faction = document.getElementById("faction").value;
      resetStats();  // Reset stats before applying new effect

      currentFaction = faction;

      switch (faction) {
        case "Armor Boost":
          currentStats.armor += 20;
          break;
        case "Speed Boost":
          currentStats.speed += 15;
          break;
        case "Heat Reduction":
          currentStats.maxHeat += 20;
          break;
        default:
          break;
      }
      updateStatsDisplay();
    }

    // Reset Stats to Default
    function resetStats() {
      currentStats = { ...originalStats };
    }
  </script>
</body>
</html>
